mox.require([ 'mox.DOM'],function(){mox.create('static mox.Event',{_domLoaded:[],_listeners:[],_cleanups:[],_domLoadedState:false,add:function(o,n,f,s){var ev=this,cb;if(!o)return null;o=mox.DOM.get(o);if(n=='init')n='DOMContentLoaded';cb=function(e){e=e||window.event;if(e&&!e.target)e.target=e.srcElement;if(!s)return f(e);return f.call(s,e);};if(mox.contentLoaded&&n=='DOMContentLoaded'){cb();return;}if((mox.isIE||mox.isSafari)&&n=='DOMContentLoaded'){this._domLoaded.push(cb);return cb;}this._listeners.push({obj:o,name:n,func:f,cfunc:cb,scope:s});this._addEvent(o,n,cb);return cb;},remove:function(o,n,f){var i,li=this._listeners,it;if(!o)return null;o=mox.DOM.get(o);this._removeEvent(o,n,f);for(i=0;i<li.length;i++){it=li[i];if(it.obj==o&&it.name==n&&it.func==f){this._removeEvent(it.obj,it.name,it.cfunc);li.splice(i,1);return f;}}return null;},removeAll:function(o){var i,li,it;for(i=0,li=this._listeners;i<li.length;i++){it=li[i];if(it.obj==o){this._removeEvent(it.obj,it.name,it.cfunc);li.splice(i,1);}}},cancel:function(e){var t=mox.Event;t.stopPropagation(e);return t.preventDefault(e);},stopPropagation:function(e){if(!e)return false;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true;return false;},preventDefault:function(e){if(!e)return false;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;},fire:function(o,n,e){var i,li,it;if(!e)return false;for(i=0,li=this._listeners;i<li.length;i++){it=li[i];if(it.obj==o&&it.name==n)it.cfunc(e);}return true;},getPageXY:function(e){var d=document,de=d.documentElement||d.body,x=e.pageX||e.clientX||0,y=e.pageY||e.clientY||0;if(mox.isIE){x+=de.scrollLeft;y+=de.scrollTop;}return{x:x,y:y};},addCleanup:function(f){this._cleanups.push(f);},_unLoad:function(){var i,ev=mox.Event,li,it,ex;for(i=0,li=ev._listeners;i<li.length;i++){it=li[i];try{ev._removeEvent(it.obj,it.name,it.cfunc);it.obj=it.name=it.cfunc=null;}catch(ex){}}for(i=0,li=ev._cleanups;i<li.length;i++){try{li[i]();}catch(ex){}}ev._removeEvent(window,'unload',ev._unLoad);ev._listeners=[];ev._cleanups=[];},_addEvent:function(o,n,f){if(o.attachEvent)o.attachEvent('on'+n,f);else if(o.addEventListener)o.addEventListener(n,f,false);else o['on'+n]=f;},_removeEvent:function(o,n,f){if(o.detachEvent)o.detachEvent('on'+n,f);else if(o.removeEventListener)o.removeEventListener(n,f,false);else o['on'+n]=null;},_DOMContentLoadedIE:function(){var e=document.getElementById('_ie_lo');if(e.readyState=="complete"){this._dispatchDOMContentLoaded();e.onreadystatechange=null;}},_dispatchDOMContentLoaded:function(){var i,ar=mox.Event._domLoaded;for(i=0;i<ar.length;i++)ar[i](window.event);mox.Event._domLoaded=[];mox.contentLoaded=true;},_waitForLoaded:function(){if (/loaded|complete/.test(document.readyState))this._dispatchDOMContentLoaded();else window.setTimeout('mox.Event._waitForLoaded();',10);},_handleDOMContentLoaded:function(d){d=!d?document:d;if(mox.isIE){try{document.execCommand('BackgroundImageCache',false,true);}catch(e){}}this._addEvent(window,'unload',this._unLoad);if(mox.isIE||mox.isSafari)this._waitForLoaded();}});mox.Event._handleDOMContentLoaded();});mox.require([ 'mox.List','mox.geom.Point','mox.geom.Rect'],function(){var List=mox.List;mox.create('mox.DOMUtils',{_counter:0,_doc:null,DOMUtils:function(doc){this._doc=doc;},selectElements:function(n,na,f){var i,a=[],nl,x;n=this.get(n);for(x=0,na=na.split(',');x<na.length;x++)for(i=0,nl=n.getElementsByTagName(na[x]);i<nl.length;i++)f(nl[i])&&a.push(nl[i]);return a;},select:function(p,s){var o=[],r=[],i,t=this,pl,ru,pu,x,u,xp;s=!s?this._doc.body:this.get(s);for(i=0,pl=p.split(',');i<pl.length;i++){ru=[];xp='.';for(x=0,pu=pl[i].split(' ');x<pu.length;x++){u=pu[x];if(u!=''){u=u.match(/^([\w\\]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@([\w\\]+)([\^\$\*!]?=)([\w\\]+)\])?(?:\:([\w\\]+))?/i);if(document.evaluate){xp+=u[1]?'//'+u[1]:'//*';if(u[2])xp+="[@id='"+u[2]+"']";if(u[3]){List.each(u[3].split('.'),function(i,n){xp+="[@class = '"+n+"' or contains(concat(' ', @class, ' '), ' "+n+" ')]";});}if(u[4]){if(u[5]){if(u[5]=='^=')xp+="[starts-with(@"+u[4]+",'"+u[6]+"')]";else if(u[5]=='$=')xp+="[contains(concat(@"+u[4]+",'\0'),'"+u[6]+"\0')]";else if(u[5]=='*=')xp+="[contains(@"+u[4]+",'"+u[6]+"')]";else if(u[5]=='!=')xp+="[@"+u[4]+"!='"+u[6]+"']";}else xp+="[@"+u[4]+"='"+u[6]+"']";}}else ru.push({tag:u[1],id:u[2],cls:u[3]?new RegExp('\\b'+u[3].replace(/\./g,'|')+'\\b'):null,attr:u[4],val:u[5]});}}if(xp.length>1)ru.xpath=xp;r.push(ru);}function find(e,rl,p){var nl,i,n,ru=rl[p];for(i=0,nl=e.getElementsByTagName(!ru.tag?'*':ru.tag);i<nl.length;i++){n=nl[i];if(ru.id&&n.id!=ru.id)continue;if(ru.cls&&!ru.cls.test(n.className))continue;if(ru.attr&&t.getAttrib(n,ru.attr)!=ru.val)continue;if(p<rl.length-1)find(n,rl,p+1);else o.push(n);}};for(i=0;i<r.length;i++){if(r[i].xpath){ru=this._doc.evaluate(r[i].xpath,s,null,4,null);while(u=ru.iterateNext())o.push(u);}else find(s,r[i],0);}return o;},getViewPort:function(w){var d,b;w=!w?window:w;d=w.document;b=d.compatMode=='CSS1Compat'?d.documentElement:d.body;return new mox.geom.Rect(w.pageXOffset||b.scrollLeft,w.pageYOffset||b.scrollTop,w.innerWidth||b.clientWidth,w.innerHeight||b.clientHeight);},getParent:function(n,f,r){n=this.get(n);while(n){if(n==r)return null;if(f(n))return n;n=n.parentNode;}return null;},add:function(p,n,a,h){var t=this,e;e=this._doc.createElement(n);for(n in a){if(a.hasOwnProperty(n))t.setAttrib(e,n,a[n]);}if(h){if(h.nodeType)e.appendChild(h);else e.innerHTML=h;}return p?p.appendChild(e):e;},create:function(n,a,h){return this.add(0,n,a,h);},createTag:function(tn,a,h){var n,o=this._doc.createElement(tn);if(a){for(n in a){if(typeof(a[n])!='function'&&a[n]!=null){this.setAttrib(o,n,a[n]);}}}if(h)o.innerHTML=h;return o;},addTags:function(te,ne){var i,n;te=this.get(te);if(typeof(ne)=='string')te.appendChild(this._doc.createTextNode(ne));else if(ne.length){te=te.appendChild(this.createTag(ne[0],ne[1]));for(i=2;i<ne.length;i++)this.addTags(te,ne[i]);}},setAttrib:function(e,n,v){e=this.get(e);if(!e)return false;if(n=="style")e.style.cssText=v;if(n=="class")e.className=v;if(v!=null&&v!="")e.setAttribute(n,''+v);else e.removeAttribute(n);},setAttribs:function(e,o){var n;e=this.get(e);if(!e)return false;for(n in o){if(typeof(o[n])!='function')this.setAttrib(e,n,o[n]);}},getAttrib:function(e,n,dv){var v;e=this.get(e);if(!e)return false;if(typeof(dv)=="undefined")dv="";v=e.getAttribute(n,2);if(!v)v=e.attributes[n];if(n=="class"&&!v)v=e.className;if(n=="style"&&!v)v=e.style.cssText;return(v&&v!="")?v:dv;},setStyle:function(n,na,v){var s,i;if(!n)return false;n=typeof(n)=='string'?n.split(','):[n];for(i=0;i<n.length;i++){s=this.get(n[i]);if(!s)continue;s=s.style;na=na.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});if(na=='opacity'){if(mox.isIE){s.filter="alpha(opacity="+(v * 100)+")";if(!n.currentStyle||!n.currentStyle.hasLayout)s.display='inline-block';}s['-moz-opacity']=s['-khtml-opacity']=v;}s[na]=v;}},setStyles:function(e,o){var n;if(!e)return false;for(n in o){if(typeof(o[n])!='function')this.setStyle(e,n,o[n]);}},getStyle:function(n,na,d){n=this.get(n);if(!n)return false;if(this._doc.defaultView){try{return this._doc.defaultView.getComputedStyle(n,null).getPropertyValue(na);}catch(n){return null;}}na=na.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});if(n.currentStyle)return n.currentStyle[na];return false;},getByClass:function(n,na,c){var t=this;return this.selectElements(this.get(n),na,function(no){return t.hasClass(no,c);});},get:function(n){return typeof(n)=='string'?this._doc.getElementById(n):n;},show:function(id){this.setStyle(id,'display','block');},hide:function(id){this.setStyle(id,'display','none');},isHidden:function(id){return this.getStyle(id,'display')=='none';},setVisible:function(id,s){this.setStyle(id,'visibility',s?'visible':'hidden');return s;},isVisible:function(id){return this.getStyle(id,'visibility')=='visible';},getPos:function(n,ab,cn){var l=0,t=0,p,r,d;n=this.get(n);if(ab)return new mox.geom.Point(parseInt(this.getStyle(n,'left')),parseInt(this.getStyle(n,'top')));if(n&&n.getBoundingClientRect){r=n.getBoundingClientRect();d=document;n=d.compatMode=='CSS1Compat'?d.documentElement:d.body;return new mox.geom.Point(r.left+(n.scrollLeft||0),r.top+(n.scrollTop||0));}while(n&&n!=cn){l+=n.offsetLeft||0;t+=n.offsetTop||0;n=n.offsetParent;}return new mox.geom.Point(l,t);},getRect:function(e,ab,r){var p,r;e=this.get(e);p=this.getPos(e,ab);r=!r?new mox.geom.Rect():r;r.set(p.x,p.y,parseInt(this.getStyle(e,'width'))||e.offsetWidth,parseInt(this.getStyle(e,'height'))||e.offsetHeight);return r;},remove:function(id){var i,n;for(i=0,id=id.split(',');i<id.length;i++){n=this.get(id[i]);if(n)n.parentNode.removeChild(n);}},addClass:function(e,c,b){var o;e=this.get(e);if(!e)return null;o=this.removeClass(e,c);return e.className=b?c+(o!=''?(' '+o):''):(o!=''?(o+' '):'')+c;},removeClass:function(e,c){e=this.get(e);if(!e)return null;c=e.className.replace(new RegExp("(^|\\s+)"+c+"(\\s+|$)","g"),' ');return e.className=c!=' '?c:'';},replaceClass:function(e,o,n){if(this.hasClass(e,o)){this.removeClass(e,o);this.addClass(e,n);}},hasClass:function(n,c){n=this.get(n);return new RegExp('\\b'+c+'\\b','g').test(n.className);},getOuterHTML:function(e){var d;e=this.get(e);if(mox.isIE||mox.isOpera)return e.outerHTML;d=e.ownerDocument.createElement("body");d.appendChild(e.cloneNode(true));return d.innerHTML;},setOuterHTML:function(e,h){var i,nl,t;e=this.get(e);if(mox.isIE)e.outerHTML=h;else{t=e.ownerDocument.createElement("body");t.innerHTML=h;for(i=0,nl=t.childNodes;i<nl.length;i++)e.parentNode.insertBefore(nl[i].cloneNode(true),e);e.parentNode.removeChild(e);}},importCSS:function(css){var i,e,he,d=this._doc;css=css.split(',');for(i=0;i<css.length;i++){if(!d.createStyleSheet){e=d.createElement("link");e.rel="stylesheet";e.href=css[i];if((he=d.getElementsByTagName("head"))!=null&&he.length>0)he[0].appendChild(e);}else d.createStyleSheet(css[i]);}},uniqueId:function(p){return(!p?'mox_':p)+(this._counter++);}});mox.DOM=new mox.DOMUtils(document);mox.provide('mox.DOM');});mox.require([ 'mox.DOM','mox.List'],function(){var DOM=mox.DOM;var List=mox.List;function isset(o){return typeof(o)!='undefined';};mox.create('mox.tpl.Template',{targetId:null,templateId:null,templates:null,encoders:null,settings:null,Template:function(t,tpl,s){var e,n;this.targetId=t;this.templateId=tpl;this.templates={};this.settings={prepend_str:'',append_str:''};for(n in s)this.settings[n]=s[n];e=this.encoders={};e.urlencode=e.escape=escape;e.encodeURIComponent=encodeURIComponent;this.addEncoder('translate',function(v,r){return mox.lang.LangPack.translate(v);});},addEncoder:function(n,f){return this.encoders[n]=f;},process:function(d){var h='',tl=this.templates;this.setup();h+=this.replace(tl.header,d);h+=this.replace(tl.item,d);h+=this.replace(tl.footer,d);this._setHTML(DOM.get(this.targetId),h);},processArray:function(d){var h='',t=this,tl=t.templates;t.setup();List.map(d,function(i,v){h+=t.replace(tl.header,v);});List.map(d,function(i,v){h+=t.replace(tl.item,v);});List.map(d,function(i,v){h+=t.replace(tl.footer,v);});t._setHTML(DOM.get(t.targetId),h);},processNameValue:function(d){var h='',tl=this.templates;this.setup();h+=this.replace(tl.header,d);h+=this.replaceNameValue(tl.item,d);h+=this.replace(tl.footer,d);this._setHTML(DOM.get(this.targetId),h);},processTable:function(d){var h='',tl=this.templates;this.setup();h+=this.replace(tl.header,d.result.header);h+=this.replaceTable(tl.item,d.result.columns,d.result.data);h+=this.replace(tl.footer,d,d.result.header);this._setHTML(DOM.get(this.targetId),h);},processResultSet:function(d){var h='',tl=this.templates;this.setup();h+=this.replace(tl.header,d.header);h+=this.replaceTable(tl.item,d.columns,d.data);h+=this.replace(tl.footer,d,d.header);this._setHTML(DOM.get(this.targetId),h);},replaceNameValue:function(t,d){var n,h='';if(!t)return '';for(n in d){if(typeof(d[n])=='string')h+=this.replace(t,{name:n,value:d[n]});}return h;},replaceTable:function(t,c,d){var i,te,h='',o;if(!t)return '';for(i=0;i<d.length;i++)h+=this.replace(t,this.makeRow(c,d[i],i,d.length));return h;},makeRow:function(c,d,idx,len){var o={},i;o.$index=idx;o.$length=len;for(i=0;i<c.length;i++)o[c[i]]=d[i];return o;},replace:function(t,d){var te=this,e=te.encoders;if(!t)return '';t=t.replace(/\{\$([^\}]+)\}/g,function(a,b){var l=b.split('|'),i,v=l[0].indexOf('.')!=-1?eval('d.'+l[0]):d[l[0]];if(l.length==1)v=te.xmlEncode(v);for(i=1;i<l.length;i++)v=e[l[i]](v,d);return v;});t=t.replace(/\{\=([^\}]+)\}/g,function(a,b){return eval(b);});return t;},xmlEncode:function(s){return s?(''+s).replace(new RegExp('[<>&"\']', 'g'),function(c,b){switch(c){case '&':return '&amp;';case '"':return '&quot;';case '\'':return '&#39;';case '<':return '&lt;';case '>':return '&gt;';}return c;}):s;},getTemplateStr:function(id){var tpe,h;tpe=DOM.get(id);h=tpe.innerHTML;h=h.replace(/(<!\[CDATA\[|\]\]>)/gi,'');return h;},setup:function(){var s=this.settings,tl=this.templates;if(!tl.header&&s.header_tpl)tl.header=this.getTemplateStr(s.header_tpl);if(!tl.item)tl.item=this.getTemplateStr(this.templateId);if(!tl.footer&&s.footer_tpl)tl.footer=this.getTemplateStr(s.footer_tpl);},_setHTML:function(e,h){var n=e.nodeName,s=this.settings,m,te,nl,i;h=s.prepend_str+h+s.append_str;h=h.replace(/(width|height)=\"\s*\"/gi,'');if(!mox.isGecko&&h.match(/^\s*<tr/i)){for(nl=e.childNodes,i=nl.length-1;i>=0;i--)nl[i].parentNode.removeChild(nl[i]);te=document.createElement('div');te.innerHTML='<table>'+h+'</table>';DOM.selectElements(te,'tr',function(n){e.appendChild(n.cloneNode(true));return false;});te=null;return;}if(!mox.isGecko&& /(TABLE|SELECT)/.test(n))e.outerHTML=e.outerHTML.replace(new RegExp('<'+n+'([^<]+)>.*','i'),'<'+n+'$1>'+h+'</'+n+'>');else{if(mox.isIE&&!h&& /(TBODY)/.test(n)){n=e.firstChild;if(n){do{e.removeChild(n);}while((n=n.nextSibling)!=null);}}else e.innerHTML=h;}}});});mox.require([ 'mox.List'],function(){var List=mox.List;function isset(o){return typeof(o)!='undefined';};mox.create('mox.data.ResultSet',{columns:null,data:null,header:null,ResultSet:function(result){this.header=result.header;this.columns=result.columns;this.data=result.data;},each:function(f,i){var i;for(i=0;i<this.data.length;i++){if(f(this.getRow(i),i)===false)break;}},getColumns:function(){return this.columns;},getHeader:function(){return this.header;},getRow:function(idx){var d,c=this.columns,o={},i;if(idx<0)return null;for(i=0,d=this.data[idx];i<c.length;i++)o[c[i]]=d[i];return o;},getColByName:function(r,n){var sc,c=this.columns;for(i=0,sc=-1;i<c.length;i++){if(n==c[i]){sc=i;break;}}return sc!=-1?r[sc]:null;},getRowCount:function(){return this.data.length;},orderBy:function(by,num,desc){var t=this,c=t.columns,i,sc;desc=isset(desc)&&desc;for(i=0,sc=-1;i<c.length;i++){if(by==c[i]){sc=i;break;}}function numSort(a,b){a=parseFloat(a[sc]);b=parseFloat(b[sc]);a=isNaN(a)?0:a;b=isNaN(b)?0:b;return a-b;};function strSort(a,b){try{a=''+a[sc].toLowerCase();b=''+b[sc].toLowerCase();if(a==b)return 0;if(a<b)return-1;}catch(ex){}return 1;};if(sc!=-1)t.data=t.data.sort(num?numSort:strSort);if(desc)t.data=t.data.reverse();},toString:function(){var i,d=this.data,o='';for(i=0;i<d.length;i++)o+=d[i].join(',')+'\n';return o;}});});mox.require([ 'mox.DOM'],function(){var DOM=mox.DOM;mox.create('static mox.dom.Form',{selectOption:function(f,n,v){var i,ol=f.elements[n].options;for(i=0;i<ol.length;i++){if(ol[i].value==v){ol[i].selected=true;return ol[i];}}return null;},addOption:function(f,n,on,ov){var e=f.elements[n],ol=e.options;o.selected=true;return ol.push(new Option(on,ov));},getRadioValue:function(f,n){var i,nl;for(i=0,nl=f.elements[n];i<nl.length;i++){if(nl[i].checked)return nl[i].value;}return null;},getValue:function(f,n){var e=f.elements[n];switch(e.type){case 'SELECT':return e.options[e.selectedIndex].value;}return e.value;}});});mox.require([ 'moxiecode.manager.BaseManager'],function(){mox.create('moxiecode.manager.ImageManager:moxiecode.manager.BaseManager',{ImageManager:function(s){this.parent(s);},open:function(form_name,element_names,file_url,js,s){var x,y,w,h,win;s=this.merge(s,this.settings);w=785;h=500;x=parseInt(screen.width / 2.0) - (w / 2.0);y=parseInt(screen.height / 2.0) - (h / 2.0);if(moxiecode.isMSIE){w+=15;h+=35;}this.args={path:s.path,rootpath:s.rootpath,custom_data:s.custom_data,remember_last_path:s.remember_last_path};s.target_form=form_name;s.target_elements=element_names;s.insert_callback=typeof(js)=='function'?js:eval(js);this.callSettings=s;win=window.open(moxiecode.baseURL+'/../index.php?type=im','mcImageManagerWin','left='+x+',top='+y+',width='+w+',height='+h+',scrollbars=yes,resizable=yes,statusbar=no');try{}catch(ex){win.focus();}}});});new function(){function isset(o){return typeof(o)!='undefined';};mox.create('static mox.List',{filter:function(a,f,si,ei){var i,o=[];si=isset(si)?si:0;ei=isset(ei)?ei:a.length;for(i=si;i<ei;i++){if(f(i,a[i]))o.push(a[i]);}return o;},map:function(a,f,si,ei){var i;si=isset(si)?si:0;ei=isset(ei)?ei:a.length;for(i=si;i<ei;i++)f(i,a[i]);},indexOf:function(a,v){var i;for(i=0;i<a.length;i++){if(a[i]==v)return i;}return-1;},each:function(a,f){var n,v;for(n in a){if((v=f(n,a[n])))return v;}return false;},getKeys:function(a){var o=[];this.each(a,function(n,v){o.push(n);});return o;},hasValue:function(a,rv){var s=0;this.each(a,function(n,v){return s=(v==rv);});return s;},remove:function(a,rv){return this.filter(a,function(i,v){return v!=rv;});}});};mox.create('mox.geom.Point',{x:0,y:0,Point:function(x,y){this.x=x;this.y=y;},moveTo:function(x,y){this.x=x;this.y=y;},moveBy:function(x,y){this.x+=x;this.y+=y;},clone:function(){return new mox.geom.Point(this.x,this.y);}});mox.require([ 'mox.geom.Point'],function(){var Point=mox.geom.Point;mox.create('mox.geom.Rect:mox.geom.Point',{w:0,h:0,Rect:function(x,y,w,h){this.parent(x,y);this.w=w;this.h=h;},intersects:function(r){var i,p=new Point(0,0),c=['tl','tr','bl','br'];for(i=0;i<c.length;i++){p=this.getLocation(c[i],p);if(r.containsXY(p.x,p.y))return true;}return false;},containsXY:function(x,y){return x>=this.x&&x<=this.x+this.w&&y>=this.y&&y<=this.y+this.h;},contains:function(r){return this.x<=r.x&&this.y<=r.y&&this.x+this.w>=r.x+r.w&&this.y+this.h>=r.y+r.h;},getLocation:function(l,p){var v=l.charAt(0),h=l.charAt(1);p=!p?new Point(0,0):p;switch(v){case 't':p.y=this.y;break;case 'b':p.y=this.y+this.h;break;case 'c':p.y=this.y+(this.h/2);break;}switch(h){case 'l':p.x=this.x;break;case 'r':p.x=this.x+this.w;break;case 'c':p.x=this.x+(this.w/2);break;}return p;},resizeTo:function(w,h){this.w=w;this.h=h;},resizeBy:function(w,h){this.w+=w;this.h+=h;},set:function(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;},clone:function(){return new mox.geom.Rect(this.x,this.y,this.w,this.h);}});});mox.require([ 'mox.util.Dispatcher','mox.net.JSON','mox.tpl.Template'],function(){var Dispatcher=mox.util.Dispatcher;mox.create('moxiecode.manager.BaseManager',{settings:null,json:mox.net.JSON,rpcCounter:0,args:null,callSettings:null,BaseManager:function(s){var baseDir;baseDir=document.location.href;if(baseDir.indexOf('?')!=-1)baseDir=baseDir.substring(0,baseDir.indexOf('?'));baseDir=baseDir.substring(0,baseDir.lastIndexOf('/')+1);this.settings={document_base_url:unescape(baseDir),relative_urls:false,remove_script_host:false,path:null,rootpath:null,remember_last_path:true,custom_data:null,target_elements:'',target_form:''};this.onResult=new Dispatcher(this);this.onError=new Dispatcher(this);this.init(s);},init:function(s){this.merge(s,this.settings);},merge:function(s,a){var n,o={};for(n in a)o[n]=a[n];if(s){for(n in s)o[n]=s[n];}return o;},openInIframe:function(iframe_id,form_name,element_names,file_url,js,settings){mox.log('openInIframe: ',iframe_id,form_name,element_names,file_url,js,settings);},open:function(form_name,element_names,file_url,js,settings){mox.log('open: ',form_name,element_names,file_url,js,settings);},filebrowserCallBack:function(field_name,url,type,win){var s;if(typeof(mcFileManager)!="undefined"&&type=="file"){mcFileManager.filebrowserCallBack(field_name,url,type,win);return;}this.field=field_name;this.callerWindow=win;this.inTinyMCE=true;s={path:tinyMCE.getParam("imagemanager_path"),rootpath:tinyMCE.getParam("imagemanager_rootpath"),remember_last_path:tinyMCE.getParam("imagemanager_remember_last_path"),custom_data:tinyMCE.getParam("imagemanager_custom_data"),is_callback:true};this.open(0,field_name,url,mox.bind(this,this.insertFileToTinyMCE),s);},insertFileToTinyMCE:function(url){var url;if(typeof(TinyMCE_convertURL)!="undefined")url=TinyMCE_convertURL(url,null,true);else url=tinyMCE.convertURL(url,null,true);this.callerWindow.document.forms[0].elements[this.field].value=url;try{this.callerWindow.document.forms[0].elements[this.field].onchange();}catch(e){}},selectFile:function(d){this.insertFileToForm(d.url,d);},insertFileToForm:function(url,d){var s=this.callSettings,elements=s.target_elements.split(','),i,elm;if(s.insert_callback)s.insert_callback(url,d);if(s.relative_urls)url=new mox.utils.URL(url).getRelativePath(s.document_base_url);if(s.remove_script_host)url=this.removeHost(url);for(i=0;i<elements.length;i++){elm=document.forms[s.target_form].elements[elements[i]];if(elm&&typeof elm!="undefined")elm.value=url;try{elm.onchange();}catch(e){}}},removeHost:function(url){return url.replace(/^(\w+:\/\/)([^\/]+)/,'');},getArgs:function(){return this.args;},execRPC:function(m,o,c,ec){var ma=this,json=ma.json,s=ma.settings,co=ma.rpcCounter++;json.send(mox.baseURL+'/../rpc/'+(mox.defaultDoc?mox.defaultDoc:''),{method:m,params:[o],id:'c'+co},function(status,response,text){var t,li;if(status!='OK'){ma.onError.dispatch(m,'Critical JSON failure: '+status,null,co,text);return;}if(!response)return;if(response.result)ma.onResult.dispatch(m,response.result,co,text);if(response.error){if(!ec)ma.onError.dispatch(m,response.error,response.result,co,text);else ec(response);return;}switch(typeof(c)){case 'function':c(response,o);break;case 'object':c.processTable(response);break;case 'string':t=new mox.template.GridFill(c);t.process(response);break;}});}});});mox.require([ 'mox.List'],function(){mox.create('mox.util.Dispatcher',{_listeners:null,_scope:null,Dispatcher:function(s){this._listeners=[];this._scope=s;},add:function(f,s){this._listeners.push({func:f,scope:!s?this._scope:s});},dispatch:function(){var a=arguments,s=true;mox.List.each(this._listeners,function(i,v){return s=v.func.apply(!v.scope?window:v.scope,a);});return s;}});});mox.create('static mox.net.JSON',{synchronous:false,debug:false,encoded:false,serialize:function(o){var i,v,s=mox.net.JSON.serialize,t;if(o==null)return 'null';t=typeof o;if(t=='string'){v='\bb\tt\nn\ff\rr\""\'\'\\\\';return '"'+o.replace(new RegExp('([\u0080-\uFFFF\\x00-\\x1f\\\\"])','g'),function(a,b){i=v.indexOf(b);if(i+1)return '\\'+v.charAt(i+1);a=b.charCodeAt().toString(16);return '\\u'+'0000'.substring(a.length)+a;})+'"';}if(t=='object'){if(o instanceof Array){for(i=0,v='[';i<o.length;i++)v+=(i>0?',':'')+s(o[i]);return v+']';}v='{';for(i in o)v+=typeof o[i]!='function'?(v.length>1?',"':'"')+i+'":'+s(o[i]):'';return v+'}';}return ''+o;},unserialize:function(s){if(!mox.isSafari){if(!/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(s))return 'INVALID_JSON_STRING';}try{return eval('('+s+')');}catch(ex){return 'INVALID_JSON_STRING';}},send:function(u,o,r,e,i){if(mox.net.JSON.synchronous)this.sendSync(u,o,r,e,i);else this.sendAsync(u,o,r,e,i);},sendSync:function(u,o,r,e,i){var j=this,x;function g(s){x=0;try{x=new ActiveXObject(s);}catch(s){}return x;};x=window.ActiveXObject?g('Msxml2.XMLHTTP')||g('Microsoft.XMLHTTP'):new XMLHttpRequest();if(!x)return r('ERR_NO_XMLHTTP',null,x.responseText,u,o,x);!i||i(x);x.overrideMimeType&&x.overrideMimeType('text/plain');x.open('POST',u,false);x.setRequestHeader('Content-Type','application/json');x.async=false;x.send(j.serialize(o));if(j.debug){mox.log("RPC Request [JSON]: "+j.serialize(o));mox.log("RPC Response [OBJ]: ",j.unserialize(x.responseText));mox.log("RPC Response [JSON]: "+x.responseText);}c=j.unserialize(x.responseText);if(c=='INVALID_JSON_STRING')return r('ERR_NOT_JSON',null,x.responseText,u,o,x);r('OK',c,x.responseText,u,o,x);},sendAsync:function(u,o,r,e,i){var j=this,x,p;function g(s){x=0;try{x=new ActiveXObject(s);}catch(s){}return x;};x=window.ActiveXObject?g('Msxml2.XMLHTTP')||g('Microsoft.XMLHTTP'):new XMLHttpRequest();if(!x)return cb('ERR_NO_XMLHTTP',null,x.responseText,u,o,x);!i||i(x);x.open('POST',u,true);if(!e&&!mox.net.JSON.encoded){x.overrideMimeType&&x.overrideMimeType('text/plain');x.setRequestHeader('Content-Type','application/json');p=j.serialize(o);}else{p="json_data="+escape(j.serialize(o));x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.setRequestHeader("Content-length",p.length);}this.waitForResponse(u,o,x,r,e,i);x.send(p);},waitForResponse:function(u,o,x,cb,e,i){var j=this,t,c=0;t=window.setInterval(function(){if(x.readyState==4||c++>10000){window.clearInterval(t);if(x.status==403||x.status==404||x.status==405){mox.net.JSON.encoded=1;if(!e)j.sendAsync(u,o,cb,1,i);return false;}if(x.readyState==4){if(j.debug){mox.log("RPC Request [JSON]: "+j.serialize(o));mox.log("RPC Response [OBJ]: ",j.unserialize(x.responseText));mox.log("RPC Response [RAW]: "+x.responseText);}}if(c>10000)return cb('ERR_TIMEOUT',null,x.responseText,u,o,x);c=j.unserialize(x.responseText);if(c=='INVALID_JSON_STRING')return cb('ERR_NOT_JSON',null,x.responseText,u,o,x);cb('OK',c,x.responseText,u,o,x);}},10);}});